---
import { Image } from 'astro:assets'
import { Header, Footer, Layout } from 'astro-travelens'
import Document from '../../data/document'
import Documents from '../../components/Documents.astro'

import Cover from '../../assets/dominik-schroder-FIKD9t5_5zQ-unsplash.jpg'


export async function getStaticPaths() {
  const documents = import.meta.glob<Document[]>('../../data/*.json', { import: 'default', eager: true })
  const tags = Object.keys(documents).map(doc => documents[doc].map(entry => entry.tags.map(tag => {
    return {
      tag: tag,
      documents: Object.keys(documents).map(doc => documents[doc]).flat(3).filter(doc => doc.tags.includes(tag))
    }
  }))).flat(3)
  return tags.map(tag => ({
    params: { tag: tag.tag }, props: { tag: tag.tag, documents: tag.documents },
  }))
}

export interface Props {
  tag: string
  documents: Document[]
}
const { tag, documents } = Astro.props
---
<Layout title={"Tag: " + tag}>
  <Header />
  <div class="-mt-24 relative w-full bg-black flex items-center justify-center overflow-hidden">
    <div class="relative h-96">
        <Image src={Cover} class="w-full object-cover opacity-50" alt="Background"/>
    </div>
  </div>
  <div class="max-w-4xl mx-auto bg-white pt-12 px-12 lg:px-24 -mt-32 relative z-10 pb-12 mb-4">
      <h2 class="mt-4 uppercase tracking-widest text-xs text-gray-600">travelens</h2>
      <h1 class="font-display text-2xl md:text-3xl text-gray-900 mt-4">Tag: {tag}</h1>
  </div>
  <Documents documents={documents} />
  <Footer />
</Layout>